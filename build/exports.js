#! /usr/bin/env node
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("https"),require("sha1")):"function"==typeof define&&define.amd?define(["https","sha1"],t):"object"==typeof exports?exports["youtube-music-ts-api"]=t(require("https"),require("sha1")):e["youtube-music-ts-api"]=t(e.https,e.sha1)}(global,((e,t)=>(()=>{"use strict";var s={523:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default={context:{capabilities:{},client:{clientName:"WEB_REMIX",clientVersion:"0.1",experimentIds:[],experimentsToken:"",gl:"DE",hl:"en",locationInfo:{locationPermissionAuthorizationStatus:"LOCATION_PERMISSION_AUTHORIZATION_STATUS_UNSUPPORTED"},musicAppInfo:{musicActivityMasterSwitch:"MUSIC_ACTIVITY_MASTER_SWITCH_INDETERMINATE",musicLocationMasterSwitch:"MUSIC_LOCATION_MASTER_SWITCH_INDETERMINATE",pwaInstallabilityStatus:"PWA_INSTALLABILITY_STATUS_UNKNOWN"},utcOffsetMinutes:60},request:{internalExperimentFlags:[{key:"force_music_enable_outertube_tastebuilder_browse",value:"true"},{key:"force_music_enable_outertube_playlist_detail_browse",value:"true"},{key:"force_music_enable_outertube_search_suggestions",value:"true"}],sessionIndex:{}},user:{enableSafetyMode:!1}}}},479:function(e,t,s){var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,i)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),i=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=s(116);Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n(a).default}}),i(s(800),t),i(s(189),t)},800:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},189:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},175:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(s(841)),n=r(s(421));class a extends i.default{constructor(){super(),this.trackParser=new n.default}parseAlbumsSummaryResponse(e){const t=[],s=this.traverse(e,"contents","singleColumnBrowseResultsRenderer","tabs","0","tabRenderer","content","sectionListRenderer","contents","*","itemSectionRenderer","contents","0","gridRenderer","items");if(Array.isArray(s))for(let e=0;e<s.length;e++){const r=s[e],i=this.parseAlbumSummary(r);i&&t.push(i)}return t}parseAlbumSummary(e){let t,s;const r=this.traverse(e,"musicTwoRowItemRenderer","subtitle","runs");if(Array.isArray(r)){const e=this.traverse(r,"2","navigationEndpoint","browseEndpoint","browseId");e&&(t={id:e,name:this.traverse(r,"2","text")}),s=this.traverse(r,"4","text")}return{id:this.traverse(e,"musicTwoRowItemRenderer","title","runs","0","navigationEndpoint","browseEndpoint","browseId"),name:this.traverse(e,"musicTwoRowItemRenderer","title","runs","0","text"),artist:t,year:s}}parseAlbumDetailResponse(e){const t=this.traverse(e,"frameworkUpdates","entityBatchUpdate","mutations");if(Array.isArray(t)){let s,r,i=[],n=[];for(const e of t){if(!s){const t=this.traverse(e,"payload","musicAlbumRelease");t&&(s=t)}if(!r){const t=this.traverse(e,"payload","musicAlbumReleaseDetail");t&&(r=t)}const t=this.traverse(e,"payload","musicArtist");t&&i.push(t);const a=this.traverse(e,"payload","musicTrack");a&&n.push(a)}const a={id:this.traverse(e,"responseContext","serviceTrackingParams","0","params","1","value"),name:this.traverse(s,"title")},o=this.parseAlbumDetailArtists(i),u=this.trackParser.parseAlbumTrackDetails(n,o,a);return{id:a.id,name:a.name,description:this.traverse(r,"description"),durationMillis:parseInt(this.traverse(s,"durationMs")),count:parseInt(this.traverse(s,"trackCount")),releaseDay:this.traverse(s,"releaseDate","day"),releaseMonth:this.traverse(s,"releaseDate","month"),releaseYear:this.traverse(s,"releaseDate","year"),artists:o,tracks:u}}}parseAlbumDetailArtists(e){const t=[];for(const s of e)t.push({id:this.traverse(s,"externalChannelId"),name:this.traverse(s,"name")});return t}}t.default=a},304:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(s(841));class n extends i.default{constructor(){super()}parseArtistsSummaryResponse(e){const t=[],s=this.traverse(e,"contents","singleColumnBrowseResultsRenderer","tabs","0","tabRenderer","content","sectionListRenderer","contents","*","itemSectionRenderer","contents","0","musicShelfRenderer","contents");if(Array.isArray(s))for(let e=0;e<s.length;e++){const r=s[e],i=this.parseArtistSummary(r);i&&t.push(i)}return t}parseArtistSummary(e){return{id:this.traverse(e,"musicResponsiveListItemRenderer","navigationEndpoint","browseEndpoint","browseId"),name:this.traverse(e,"musicResponsiveListItemRenderer","flexColumns","0","musicResponsiveListItemFlexColumnRenderer","text","runs","0","text")}}}t.default=n},841:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{traverse(e,...t){if(e){if(Array.isArray(t)&&t.length>0){if(Array.isArray(e)&&"*"===t[0]){for(let s=0;s<e.length;s++){const r=this.traverse(e[s],...t.slice(1));if(r)return r}return}return this.traverse(e[t[0]],...t.slice(1))}return e}}}},660:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(s(841)),n=r(s(421));class a extends i.default{constructor(){super(),this.trackParser=new n.default}parsePlaylistsSummaryResponse(e){const t=[],s=this.traverse(e,"contents","singleColumnBrowseResultsRenderer","tabs","0","tabRenderer","content","sectionListRenderer","contents","0","gridRenderer","items");if(Array.isArray(s))for(let e=1;e<s.length;e++){const r=s[e],i=this.parsePlaylistSummary(r);i&&t.push(i)}return t}parsePlaylistSummary(e){let t=0;const s=this.traverse(e,"musicTwoRowItemRenderer","subtitle","runs"),r=/(\d+)\s+\w+/;if(Array.isArray(s))for(let e=0;e<s.length;e++){const i=s[e].text,n=i?i.match(r):void 0;if(n&&n.length>1){t=parseInt(n[1]);break}}return{id:this.traverse(e,"musicTwoRowItemRenderer","title","runs","0","navigationEndpoint","browseEndpoint","browseId"),name:this.traverse(e,"musicTwoRowItemRenderer","title","runs","0","text"),count:t}}parsePlaylistDetailResponse(e){const t=this.traverse(e,"contents","singleColumnBrowseResultsRenderer","tabs","0","tabRenderer","content","sectionListRenderer","contents","0","musicPlaylistShelfRenderer");if(t)return this.parsePlaylistDetail(e,t)}parsePlaylistDetailContinuation(e,t){const s=this.traverse(t,"continuationContents","musicPlaylistShelfContinuation","contents"),r=this.trackParser.parseTrackDetails(s);Array.isArray(e.tracks)&&e.tracks.push.apply(e.tracks,r),e.continuationToken=this.traverse(t,"continuationContents","musicPlaylistShelfContinuation","continuations","0","nextContinuationData","continuation")}parsePlaylistDetail(e,t){const s=void 0===this.traverse(e,"header","musicEditablePlaylistDetailHeaderRenderer"),r=s?e:this.traverse(e,"header","musicEditablePlaylistDetailHeaderRenderer"),i=s?"PUBLIC":this.traverse(r,"editHeader","musicPlaylistEditHeaderRenderer","privacy"),n=this.traverse(r,"header","musicDetailHeaderRenderer");let a=0;const o=this.traverse(n,"secondSubtitle","runs","0","text");if(o){const e=o.split(" ");e&&e.length>0&&(a=parseInt(e[0]))}const u=this.traverse(t,"contents");return{id:this.traverse(t,"playlistId"),name:this.traverse(n,"title","runs","0","text"),description:this.traverse(n,"description","runs","0","text"),privacy:i,count:a,tracks:this.trackParser.parseTrackDetails(u),continuationToken:this.traverse(t,"continuations","0","nextContinuationData","continuation")}}mergeValidPlaylistTracks(...e){const t=[];for(const s of e)for(const e of s.tracks)this.trackParser.isTrackDataMissing(e)||t.find((t=>t.id===e.id))||t.push(e);return t}}t.default=a},421:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(s(841));class n extends i.default{parseTrackDetails(e){const t=[];if(Array.isArray(e))for(const s of e){const e=this.traverse(s,"musicResponsiveListItemRenderer");if(e){const s=this.parseTrackDetail(e);s&&s.id&&t.push(s)}}return t}parseTrackDetail(e){const t=[],s=this.traverse(e,"flexColumns","1","musicResponsiveListItemFlexColumnRenderer","text","runs");if(Array.isArray(s))for(const e of s){const s=this.traverse(e,"navigationEndpoint","browseEndpoint","browseId");s&&t.push({id:s,name:this.traverse(e,"text")})}let r;const i=this.traverse(e,"flexColumns","2","musicResponsiveListItemFlexColumnRenderer","text","runs","0");i&&(r={id:this.traverse(i,"navigationEndpoint","browseEndpoint","browseId"),name:this.traverse(i,"text")});const n=this.traverse(e,"fixedColumns","0","musicResponsiveListItemFixedColumnRenderer","text","simpleText")||this.traverse(e,"fixedColumns","0","musicResponsiveListItemFixedColumnRenderer","text","runs","0","text");return{id:this.traverse(e,"overlay","musicItemThumbnailOverlayRenderer","content","musicPlayButtonRenderer","playNavigationEndpoint","watchEndpoint","videoId"),alternateId:this.traverse(e,"playlistItemData","playlistSetVideoId"),title:this.traverse(e,"flexColumns","0","musicResponsiveListItemFlexColumnRenderer","text","runs","0","text"),artists:t,album:r,duration:n}}isTrackDataMissing(e){return"Song is private"==e.title}parseTracksDetailResponse(e){const t=this.traverse(e,"contents","singleColumnBrowseResultsRenderer","tabs","0","tabRenderer","content","sectionListRenderer","contents","*","itemSectionRenderer","contents","0","musicShelfRenderer"),s=this.traverse(t,"contents");return{continuationToken:this.traverse(t,"continuations","0","nextContinuationData","continuation"),tracks:this.parseTrackDetails(s)}}parseTracksDetailContinuation(e,t){const s=this.traverse(t,"continuationContents","musicShelfContinuation","contents"),r=this.parseTrackDetails(s);Array.isArray(e.tracks)&&e.tracks.push.apply(e.tracks,r),e.continuationToken=this.traverse(t,"continuationContents","musicShelfContinuation","continuations","0","nextContinuationData","continuation")}parseAlbumTrackDetails(e,t,s){const r=[];for(const i of e)r.push({id:this.traverse(i,"videoId"),title:this.traverse(i,"title"),artists:t,album:s,durationMillis:parseInt(this.traverse(i,"lengthMs")),trackNumber:parseInt(this.traverse(i,"albumTrackIndex"))});return r}}t.default=n},653:function(e,t,s){var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{u(r.next(e))}catch(e){n(e)}}function o(e){try{u(r.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(s(26)),a=i(s(418));class o extends a.default{constructor(e,t,s,r,i,n,a){super(),this.hsid=e,this.ssid=t,this.apisid=s,this.sapisid=r,this.secure3psid=i,this.secure3papisid=n,this.authUser=a}generateHeaders(){return Object.assign(Object.assign({},super.generateHeaders()),{Authorization:this.generateAuthorization(),Cookie:this.generateCookie(),"X-Goog-AuthUser":this.authUser})}generateAuthorization(){let e=(new Date).getTime();const t=`${e} ${this.secure3papisid} ${this.origin}`;return`SAPISIDHASH ${e}_${(0,n.default)(t)}`}generateCookie(){return`HSID=${this.hsid}; SSID=${this.ssid}; APISID=${this.apisid}; SAPISID=${this.sapisid}; __Secure-3PSID=${this.secure3psid}; __Secure-3PAPISID=${this.secure3papisid}`}getLibraryAlbums(){return r(this,void 0,void 0,(function*(){const e=yield this.sendRequest("browse",{browseId:"FEmusic_liked_albums"});return this.albumParser.parseAlbumsSummaryResponse(e)}))}getLibraryArtists(){return r(this,void 0,void 0,(function*(){const e=yield this.sendRequest("browse",{browseId:"FEmusic_library_corpus_track_artists"});return this.artistParser.parseArtistsSummaryResponse(e)}))}getLibraryPlaylists(){return r(this,void 0,void 0,(function*(){const e=yield this.sendRequest("browse",{browseId:"FEmusic_liked_playlists"});return this.playlistParser.parsePlaylistsSummaryResponse(e)}))}getLibraryTracks(){return r(this,void 0,void 0,(function*(){return this.getLibraryTracksInternal()}))}getLibraryTracksInternal(){return r(this,void 0,void 0,(function*(){const e={browseId:"FEmusic_liked_videos"},t=yield this.sendRequest("browse",e),s=this.trackParser.parseTracksDetailResponse(t);for(;s.continuationToken;){const t=yield this.sendRequest("browse",e,`ctoken=${s.continuationToken}&continuation=${s.continuationToken}`);this.trackParser.parseTracksDetailContinuation(s,t)}return s.tracks}))}getLibraryHistory(){return r(this,void 0,void 0,(function*(){const e=yield this.sendRequest("browse",{browseId:"FEmusic_history"}),t=this.playlistParser.traverse(e,"contents","singleColumnBrowseResultsRenderer","tabs","0","tabRenderer","content","sectionListRenderer","contents","0","musicShelfRenderer");return{id:"FEmusic_history",name:"History",description:"Recently played music in reverse chronological order",privacy:"PRIVATE",count:t.contents.length,tracks:this.trackParser.parseTrackDetails(t.contents)}}))}createPlaylist(e,t,s,i){return r(this,void 0,void 0,(function*(){const r=yield this.sendRequest("playlist/create",{title:e,description:t,privacyStatus:s||"PRIVATE",sourcePlaylistId:this.playlistIdTrim(i)});if(r&&r.playlistId)return{id:r.playlistId,name:e,count:0}}))}deletePlaylist(e){return r(this,void 0,void 0,(function*(){return"STATUS_SUCCEEDED"===(yield this.sendRequest("playlist/delete",{playlistId:this.playlistIdTrim(e)})).status}))}addTracksToPlaylist(e,...t){return r(this,void 0,void 0,(function*(){return"STATUS_SUCCEEDED"===(yield this.sendRequest("browse/edit_playlist",{playlistId:this.playlistIdTrim(e),actions:t.map((e=>({action:"ACTION_ADD_VIDEO",addedVideoId:e.id})))})).status}))}removeTracksFromPlaylist(e,...t){return r(this,void 0,void 0,(function*(){const s=[];for(const e of t){if(!e.id)throw new Error("Track ID is missing. Ensure you have both the ID and the Alternate ID.");if(!e.alternateId)throw new Error("Track Alternate ID is missing. Ensure you have both the ID and the Alternate ID.");s.push({action:"ACTION_REMOVE_VIDEO",removedVideoId:e.id,setVideoId:e.alternateId})}return"STATUS_SUCCEEDED"===(yield this.sendRequest("browse/edit_playlist",{playlistId:this.playlistIdTrim(e),actions:s})).status}))}}t.default=o},303:function(e,t,s){var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,i)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return i(t,e),t},a=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{u(r.next(e))}catch(e){n(e)}}function o(e){try{u(r.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const u=n(s(799)),l=o(s(175)),c=o(s(304)),d=o(s(660)),h=o(s(421)),p=o(s(523));t.default=class{constructor(){this.hostname="music.youtube.com",this.basePath="/youtubei/v1/",this.queryString="?alt=json&key=AIzaSyC9XL3ZjWddXya6X74dJoCTL-WEYFDNX30",this.origin="https://music.youtube.com",this.albumParser=new l.default,this.artistParser=new c.default,this.playlistParser=new d.default,this.trackParser=new h.default}generateHeaders(){return{"X-Origin":this.origin}}sendRequest(e,t,s){return a(this,void 0,void 0,(function*(){let r;t&&(t=Object.assign(Object.assign({},p.default),t),r=JSON.stringify(t));const i=s?`${this.queryString}&${s}`:this.queryString,n=yield this.sendHttpsRequest({hostname:this.hostname,path:`${this.basePath}${e}${i}`,method:"POST",headers:this.generateHeaders()},r);if(200===n.statusCode&&n.body){const e=JSON.parse(n.body);if(e)return e}throw new Error(`Could not send the specified request to ${e}. Status code: ${n.statusCode}`)}))}sendHttpsRequest(e,t){return a(this,void 0,void 0,(function*(){return new Promise(((s,r)=>{const i=e.headers||{};e.headers=i,e.timeout=6e4,t&&(i["Content-Type"]="application/json",i["Content-Length"]=t.length);const n=u.request(e,(e=>{let t="";e.on("data",(e=>{t+=e})),e.on("end",(()=>{e.body=t,s(e)}))})).on("error",(e=>{r(e)}));t&&n.write(t),n.end()}))}))}playlistIdTrim(e){return e&&e.toUpperCase().startsWith("VL")?e.substr(2):e}playlistIdPad(e){return e&&!e.toUpperCase().startsWith("VL")?"VL"+e:e}}},418:function(e,t,s){var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{u(r.next(e))}catch(e){n(e)}}function o(e){try{u(r.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(s(303));class a extends n.default{constructor(){super()}getAlbum(e){return r(this,void 0,void 0,(function*(){const t={browseId:e,browseEndpointContextSupportedConfigs:{browseEndpointContextMusicConfig:{pageType:"MUSIC_PAGE_TYPE_ALBUM"}}},s=yield this.sendRequest("browse",t);return this.albumParser.parseAlbumDetailResponse(s)}))}getPlaylist(e,t=0){return r(this,void 0,void 0,(function*(){const s=yield this.getPlaylistInternal(e);for(;t>0;){const r=s.tracks.length!==s.count,i=!!s.tracks.find((e=>this.trackParser.isTrackDataMissing(e)));if(!r&&!i)break;{const r=yield this.getPlaylistInternal(e),i=this.playlistParser.mergeValidPlaylistTracks(s,r);s.tracks=i,t--}}return s}))}getPlaylistInternal(e){return r(this,void 0,void 0,(function*(){const t={browseId:this.playlistIdPad(e),browseEndpointContextSupportedConfigs:{browseEndpointContextMusicConfig:{pageType:"MUSIC_PAGE_TYPE_PLAYLIST"}}},s=yield this.sendRequest("browse",t),r=this.playlistParser.parsePlaylistDetailResponse(s);for(;r.continuationToken;){const e=yield this.sendRequest("browse",t,`ctoken=${r.continuationToken}&continuation=${r.continuationToken}`);this.playlistParser.parsePlaylistDetailContinuation(r,e)}return r}))}}t.default=a},116:function(e,t,s){var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{u(r.next(e))}catch(e){n(e)}}function o(e){try{u(r.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(s(653)),a=i(s(418));t.default=class{authenticate(e,t=0){return r(this,void 0,void 0,(function*(){if(!e)throw new Error("The specific cookie string is missing");const s=e.split(";");if(!s||0===s.length)throw new Error("An invalid cookie string was specified");const r=new Map;for(const e of s){const t=e.split("=");t&&2===t.length&&r.set(t[0].trim(),t[1].trim())}return new n.default(r.get("HSID"),r.get("SSID"),r.get("APISID"),r.get("SAPISID"),r.get("__Secure-3PSID"),r.get("__Secure-3PAPISID"),t)}))}guest(){return r(this,void 0,void 0,(function*(){return new a.default}))}}},799:t=>{t.exports=e},26:e=>{e.exports=t}},r={};return function e(t){var i=r[t];if(void 0!==i)return i.exports;var n=r[t]={exports:{}};return s[t].call(n.exports,n,n.exports,e),n.exports}(479)})()));